<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>The (Twitter) Friends We Made Along the Way</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--  CSS  -->
    <style>
      body {
        margin: 0;
        font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      }
      body > div {
        display: flex;
        flex-direction: row;
      }
      .sidebar {
        flex: 1 1 25%;
      }
      main {
        border: thin gray;
        border-style: none solid;
        display: flex;
        flex: 2 1 50%;
        flex-direction: column;
        min-height: 100vh;
      }
      #me, main > section { 
        padding: 0 1rem; 
      }
      h2 { margin: 1rem 0 0; }
      aside {
        flex: 1 1 25%;
      }
      header {
        background-color: white;
        border-bottom: thin solid gray;
        position: -webkit-sticky;
        position: sticky;
        top: 0px;
        z-index: 99;
      }
      #list-nav {
        align-content: baseline;
        align-items: stretch;
        display: flex;
        flex-direction: row;
        text-align: center;
      }
      #list-nav a {
        flex: 1 1 50%;
        padding: 1rem;
      }
      #list-nav a:hover {
        background-color: rgba(231, 233, 234, 0.5);
      }
      .user {
        padding: 0.9rem 0;
      }
      .user-about {
        display: flex;
        flex-direction: row;
      }
      .user-icon {
        flex: 0 0 48px;
        margin-right: 0.9rem;
      }
      .user-icon a {
        display: inline-block;
        height: 48px;
        width: 48px;
      }
      .user-profile {
        
      }
      h2.user-name {
        font-size: 1.15rem;
        font-weight: 700;
        margin-top: 0;
      }
      .user-handle {
        display: block;
        font-size: 1rem;
        font-weight: normal;
      }
      .pinned-tweet {
        margin-left: 4rem;
      }
      .pinned-tweet h3 {
        color: gray;
        font-size: 0.925rem;
        margin: 0 0 0.5rem;
      }
      .pinned-tweet h3 svg {
        fill: gray;
        height: 0.8rem;
        width: 0.8rem;
      }
      .pinned-tweet .content {
        margin: 0 1rem 0.5rem 1.25rem;
      }
    </style>
    
    <!--  Javascript  -->
    <script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
    <script src="following.js"/>
    <script src="followers.js"/>
    <script>
      /* Try to load data from the JS files referenced above. If they don't exist or 
        don't set the expected variables, fall back by using a null value. */
      let followersData, followingData;
      try {
        followersData = followers;
      } catch {
        followersData = null;
      }
      try {
        followingData = following;
      } catch {
        followingData = null;
      }
    </script>
  </head>
  <body>
    <div>
      <div class="sidebar">
        
      </div>
      <main>
        <header>
          <div id="me">
            <h2>Ash Clark (e/em/eir)</h2>
            <span>@probablefutures</span>
          </div>
          <nav id="list-nav">
            <a>Followers</a>
            <a href="#following">Following</a>
          </nav>
        </header>
        <section aria-labelledby="following">
          <h1 id="following">Following</h1>
          <div id="list-following" aria-label="Timeline: following">
            
          </div>
        </section>
      </main>
      <aside>
        
      </aside>
    </div>
    <div style="display: none;">
      <!-- SVG icons -->
      <div id="pin">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
          <g><path d="M7 4.5C7 3.12 8.12 2 9.5 2h5C15.88 2 17 3.12 17 4.5v5.26L20.12 16H13v5l-1 2-1-2v-5H3.88L7 9.76V4.5z"></path></g>
        </svg>
      </div>
    </div>
    <script>
      /* Gather SVG icons for programmatic reuse. */
      const icons = {
          'pin': document.getElementById('pin').children[0].outerHTML
        };
      
      /*  */
      const generateHtml = function(plaintext, entities) {
        if ( entities !== undefined ) {
          let htmlStr = plaintext;
          
        }
      }; // END generateHtml()
      
      /* If the current user has a pinned tweet, display it. */
      const pinTweet = function(data) {
        if ( data !== null ) {
          let tweetEl = d3.select(this)
              .classed('pinned-tweet', true);
          tweetEl.append('h3')
              .html( function() {
                return icons.pin + " Pinned Tweet";
              });
          tweetEl.append('div')
              .classed('content', true)
              .text(d => d.text);
        }
      }; // END pinTweet()
      
      /* For the given user list, generate HTML for each person's data. */
      const listUsers = function(tweepList, data) {
        if ( data === null ) {
          tweepList.append('p')
              .classed('warn', true)
              .text('No data');
          return;
        }
        let tweeps = tweepList.selectAll('div')
          .data(data)
          .join('div')
            .classed('user', true);
        // Set up areas for each user.
        // User info
        tweeps.selectAll('div')
          .data(d => d)
          .join('div');
        let tweepsAbout = tweeps.selectAll('div:first-child')
            .classed('user-about', true);
        let tweepsPinned = tweeps.selectAll('div:nth-child(2)')
            .each(pinTweet);
        // User info > Icon
        tweepsAbout.call( function(selection) {
            selection.append('div')
                .classed('user-icon', true)
              .append('a')
                .attr('href', d => 'https://twitter.com/'+d.username)
                .attr('aria-hidden', 'true')
                .attr('tabindex', '-1')
                .attr('target', '_blank')
              .append('img')
                .attr('src', d => 'profile_picture/'+d.username+'.jpg')
                .attr('alt', '')
                .attr('draggable', 'true');
          })
          // User info > Profile
          .call( function(selection) {
            let profile = selection.append('div')
                .classed('user-profile', true);
            profile.append('h2')
                .classed('user-name', true)
              .append('a')
                .attr('href', d => 'https://twitter.com/'+d.username)
                .attr('target', '_blank')
                .text(d => d.name+" ")
              .append('span')
                .classed('user-handle', true)
                .text(d => '@'+d.username);
            profile.append('p')
                .classed('user-desc', true)
                .text(d => d.description);
          });
      }; // END listUsers()
    </script>
    <script>
      /* Use the functions above to generate user lists. */
      listUsers(d3.select('#list-following'), followingData);
    </script>
  </body>
</html>